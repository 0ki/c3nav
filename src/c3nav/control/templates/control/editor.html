{% extends 'control/base.html' %}
{% block content %}
<div id="mapeditor"></div>
{% endblock %}

{% block addbottom %}
<script type="text/javascript">
var map = L.map('mapeditor', {
    center: [120, 200],
    zoom: 2,
    maxBounds: [[0, 0], [{{ map.height }}, {{ map.width }}]],
    maxZoom: 10,
    minZoom: 1,
    crs: L.CRS.Simple,
});

{% for pkg in map.pkgs.values %}
L.control.layers([], {
    {% for source in pkg.sources %}
    "{{ source.name }}": L.imageOverlay('{% url 'map.source' filename=source.filename %}', {{ source.jsbounds }}),{% endfor %}
}).addTo(map);
{% endfor %}

L.LevelControl = L.Control.extend({
    options: {
        position: 'bottomright'
    },
    onAdd: function (map) {
        var container = L.DomUtil.create('div', 'leaflet-control leaflet-bar leaflet-levels'), link;
        {% for level in map.levels reversed %}
        link = L.DomUtil.create('a', '{% if current_level == level %}current{% endif %}', container);
        link.href = '{% url "control.editor" level=level %}';
        link.innerHTML = '{{ level }}';
        {% endfor %}
        return container;
    }
});
map.addControl(new L.LevelControl());

L.DrawControl = L.Control.extend({
    options: {
        position: 'topleft'
    },
    onAdd: function (map) {
        var container = L.DomUtil.create('div', 'leaflet-control leaflet-bar'), link;

        link = L.DomUtil.create('a', 'leaflet-biggericon', container);
        link.href = '{% url "control.editor" level=level %}';
        link.title = 'add building'
        link.innerHTML = 'üè†';

        link = L.DomUtil.create('a', 'leaflet-biggericon', container);
        link.href = '{% url "control.editor" level=level %}';
        link.title = 'add room/area';
        link.innerHTML = '‚¨†';

        link = L.DomUtil.create('a', 'leaflet-biggericon', container);
        link.href = '{% url "control.editor" level=level %}';
        link.title = 'add obstacle'
        link.innerHTML = '‚¨ü';

        link = L.DomUtil.create('a', 'leaflet-biggericon', container);
        link.href = '{% url "control.editor" level=level %}';
        link.title = 'add door';
        link.innerHTML = 'üö™';

        link = L.DomUtil.create('a', '', container);
        link.href = '{% url "control.editor" level=level %}';
        link.title = 'add steps';
        link.innerHTML = '‚îå‚îò';

        link = L.DomUtil.create('a', 'leaflet-biggericon', container);
        link.href = '{% url "control.editor" level=level %}';
        link.title = 'add elevator';
        link.innerHTML = '‚ñ¥‚ñæ';

        return container;
    }
});
map.addControl(new L.DrawControl());


L.control.scale({imperial: false}).addTo(map);

</script>
{% endblock %}
